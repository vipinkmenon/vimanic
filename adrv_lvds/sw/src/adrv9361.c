#include "adrv9361.h"
#include "xgpio.h"
#include "sleep.h"
#include "spi.h"



#define numSPIRegs 0x3F6

u8 defaultRegValues[] = {0x0,0x0,0x5F,0x5F,0x0,0x0,0x0,0x0,0x0,0x10,0x3,0x0,0x2,0x3,0x0,0x0,0xC0,0x0,0x4,0x1,0x13,0x8,0x0,0x0,0x0,0x0,0x0,0x0,0x10,0x1,0x0,0x0,0x33,0xA,0xA,0x3F,0x2,0x2,0x0,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xFF,0xA,0x80,0x34,0x0,0x0,0x3,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x10,0x0,0x9,0x0,0xC5,0xB8,0x2E,0xC2,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x0,0x0,0x0,0x0,0x3C,0x30,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x96,0x76,0x16,0x0,0x0,0x0,0x0,0x13,0x18,0x0,0x0,0x0,0x0,0x0,0x8,0x0,0xC1,0xC1,0x0,0x0,0x0,0x0,0x0,0x40,0x3C,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x52,0x0,0xC,0x78,0x1F,0x0,0x10,0x6,0x6,0x0,0x0,0x20,0xA,0x0,0x0,0x0,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6F,0xEF,0x1F,0x1F,0x1F,0x1F,0x1F,0x2A,0x2A,0x2A,0x20,0x0,0x3,0x0,0x0,0x0,0x55,0xF,0x1F,0x60,0x0,0x0,0x12,0x1E,0x5,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x66,0xF6,0x5E,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xE0,0x8,0x3,0x4C,0x44,0xB1,0x6F,0xA,0x29,0x8,0x2F,0x3A,0x25,0x3F,0x1F,0x4C,0x40,0x0,0x4C,0x0,0x0,0x0,0x2,0xCA,0x4A,0x4A,0x80,0x0,0x65,0x8,0x3F,0x8,0x1C,0xA,0x0,0x0,0x0,0x0,0x2D,0xBB,0x75,0xEC,0xF1,0x98,0x0,0x0,0x7,0x88,0x14,0x0,0xE7,0x0,0x0,0x0,0xAA,0x3A,0xFC,0xC6,0x23,0x28,0x0,0x8,0xD1,0xFC,0x7D,0x76,0x0,0x0,0x0,0x0,0xAC,0x5C,0x0,0x0,0x0,0xB,0x0,0x10,0x4,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x8,0x9F,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x22,0x0,0x0,0x15,0xB1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xC0,0x8,0x8,0xFF,0x0,0xB,0x18,0x0,0x0,0x0,0x0,0x40,0x49,0x5A,0xF1,0x40,0x0,0x0,0x0,0x0,0x40,0x49,0x5A,0xF1,0x40,0x0,0x0,0x0,0x10,0xB4,0x1C,0x5,0x0,0xFF,0x8D,0x0,0x64,0x0,0x0,0xD,0x5,0x3,0x3F,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x77,0x7,0xC0,0x3,0x0,0x0,0x0,0x0,0x8,0x7,0xC0,0x3,0x8,0x7,0xC0,0x3,0x43,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0xDB,0x7E,0xD,0x52,0xDB,0x7E,0xD,0x52,0x6,0x0,0x0,0x0,0x28,0x4F,0x13,0x0,0x0,0x0,0x60,0xD0,0x16,0xD0,0x16,0x8,0x8,0x0,0x0,0x98,0x98,0x1,0x0,0x60,0x0,0x60,0x0,0x60,0xE,0x68,0xE,0xDD,0xE,0x0,0x24,0x0,0x0,0x0,0x0,0x14,0x1E,0x1,0x5,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x24,0x24,0x0,0x0,0x28,0x14,0x20,0x28,0x14,0x28,0x14,0x0,0x29,0x29,0x29,0x27,0x27,0x27,0x27,0x27,0x27,0x2E,0x90,0x15,0x10,0x90,0x15,0x10,0x90,0x15,0x20,0x20,0x40,0x40,0x2C,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x54,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x82,0xA,0x0,0x0,0x80,0x0,0x0,0x0,0x0,0x4,0xD,0x8,0x0,0x0,0x0,0x7,0x2,0x2,0x40,0x0,0x80,0x0,0x0,0x63,0x8,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x85,0x76,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x54,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x82,0xA,0x0,0x0,0x80,0x0,0x0,0x0,0x0,0x4,0xD,0x8,0x0,0x0,0x0,0x7,0x2,0x2,0x40,0x0,0x80,0x0,0x0,0x63,0x8,0x0,0x0,0x0,0x14,0x0,0x0,0x0,0x80,0x0,0x0,0x6D,0x5A,0xFE,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x4,0x0,0x0,0x0,0x0,0x4,0x0,0x0,0x0,0x0,0x4C,0x18,0x0,0x0,0x0,0x4C,0x18,0x0,0x8,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0};
//u8 gnuRegValues[] = {};.


XGpio spiGPIO;

int initADRV(){
	u32 data;
	data = XGpio_Initialize(&spiGPIO,XPAR_AXI_GPIO_0_DEVICE_ID);
	if(data != XST_SUCCESS){
		print("gpio failed\n\r");
		return XST_FAILURE;
	}
	return XST_SUCCESS;
}

void adrvSoftReset(){
	XGpio_DiscreteWrite(&spiGPIO,1,0x0);
	sleep(1);
	XGpio_DiscreteWrite(&spiGPIO,1,0x1);
	sleep(1);
}


void dumpAllReg(){
	u8 data;
	for(int i=0;i<numSPIRegs;i++){
		data=spiRead(i);
		xil_printf("Register %0x  Data:%0x\n\r",i,data);
		//xil_printf("0x%0x,",data);
	}
}


void findRegChange(){
	int numChanges=0;
	u8 data;
	for(int i=0;i<numSPIRegs;i++){
		data=spiRead(i);
		if(data != defaultRegValues[i]){
			xil_printf("Register %0x changed. Default:%0x Now:%0x\n\r",i,defaultRegValues[i],data);
			numChanges++;
		}
	}
	xil_printf("Total registers changed %x\n\r",numChanges);
}
